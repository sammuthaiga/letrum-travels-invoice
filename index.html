<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invoice - Letrum Travels MVP Development</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/signature_pad/1.5.3/signature_pad.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f8f9fa;
            padding: 10px;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .header {
            border-bottom: 3px solid #7fb069;
            padding-bottom: 20px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .company-name {
            font-size: 2em;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        .company-tagline {
            font-size: 1em;
            color: #6c757d;
            margin-bottom: 20px;
        }
        
        .invoice-details {
            display: block;
            margin-bottom: 30px;
        }
        
        .invoice-info {
            background: #f0f7f0;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #7fb069;
            margin-bottom: 20px;
        }
        
        .invoice-title {
            font-size: 1.8em;
            font-weight: bold;
            color: #7fb069;
            margin-bottom: 15px;
        }
        
        .bill-to, .bill-from {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .section-title {
            font-size: 1.5em;
            color: #2c3e50;
            margin: 30px 0 20px 0;
            border-bottom: 2px solid #7fb069;
            padding-bottom: 10px;
        }
        
        .project-overview {
            background: #e8f0f7;
            color: #2c3e50;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 5px solid #7fb069;
        }
        
        /* Responsive Table Styles */
        .cost-table-wrapper {
            margin: 20px 0;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            background: white;
        }
        
        .cost-table {
            width: 100%;
            min-width: 600px;
            border-collapse: collapse;
            background: white;
        }
        
        .cost-table th {
            background: #7fb069;
            color: white;
            padding: 12px 8px;
            text-align: left;
            font-weight: 600;
            font-size: 14px;
            white-space: nowrap;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .cost-table td {
            padding: 10px 8px;
            border-bottom: 1px solid #eee;
            font-size: 14px;
            white-space: nowrap;
        }
        
        .cost-table tr:hover {
            background: #f8f9fa;
        }
        
        .completed {
            background: #e8f5e8 !important;
            color: #2d5a2d;
        }
        
        .pending {
            background: #f8f4e6 !important;
            color: #6b5b00;
        }
        
        .subtotal-row {
            background: #e9ecef !important;
            font-weight: bold;
            color: #495057;
        }
        
        .total-row {
            background: #7fb069 !important;
            color: white;
            font-weight: bold;
            font-size: 1.1em;
        }
        
        /* Mobile Table Optimization */
        @media (max-width: 768px) {
            .cost-table-wrapper {
                margin: 15px -15px;
                border-radius: 0;
                border-left: none;
                border-right: none;
                box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                position: relative;
            }
            
            /* Add scroll hint */
            .cost-table-wrapper::after {
                content: '← Swipe to view all columns →';
                position: absolute;
                bottom: -25px;
                left: 50%;
                transform: translateX(-50%);
                font-size: 12px;
                color: #6c757d;
                font-style: italic;
                white-space: nowrap;
            }
            
            .cost-table {
                min-width: 500px;
                font-size: 12px;
            }
            
            .cost-table th {
                padding: 8px 6px;
                font-size: 11px;
                font-weight: 700;
            }
            
            .cost-table td {
                padding: 8px 6px;
                font-size: 12px;
            }
            
            .cost-table td:first-child {
                max-width: 180px;
                white-space: normal;
                word-wrap: break-word;
                line-height: 1.3;
            }
            
            .cost-table th:first-child {
                max-width: 180px;
            }
            
            /* Emphasize important columns */
            .cost-table th:last-child,
            .cost-table td:last-child {
                background-color: rgba(127, 176, 105, 0.1);
                font-weight: bold;
                position: sticky;
                right: 0;
                border-left: 2px solid #7fb069;
            }
            
            .cost-table .total-row td:last-child {
                background-color: #7fb069 !important;
                color: white;
            }
            
            .cost-table .subtotal-row td:last-child {
                background-color: #e9ecef !important;
            }
            
            .cost-table .completed td:last-child {
                background-color: rgba(45, 90, 45, 0.1) !important;
            }
            
            .cost-table .pending td:last-child {
                background-color: rgba(107, 91, 0, 0.1) !important;
            }
        }
        
        /* Extra mobile optimization */
        @media (max-width: 480px) {
            .cost-table {
                min-width: 450px;
                font-size: 11px;
            }
            
            .cost-table th {
                padding: 6px 4px;
                font-size: 10px;
            }
            
            .cost-table td {
                padding: 6px 4px;
                font-size: 11px;
            }
            
            .cost-table td:first-child {
                max-width: 150px;
            }
            
            .cost-table th:first-child {
                max-width: 150px;
            }
        }
        
        /* Table View Toggle Button */
        .table-view-toggle {
            display: none;
            margin: 10px 0;
            text-align: center;
        }
        
        .toggle-btn {
            background: #7fb069;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .toggle-btn:hover {
            background: #6a9c5a;
        }
        
        .toggle-btn.inactive {
            background: #6c757d;
        }
        
        @media (max-width: 768px) {
            .table-view-toggle {
                display: block;
            }
        }
        
        /* Card Layout (as backup/alternative view) */
        .table-cards {
            display: none;
        }
        
        .table-cards.active {
            display: block;
        }
        
        .table-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-left: 4px solid #7fb069;
        }
        
        .table-card.completed {
            background: #e8f5e8;
            border-left-color: #2d5a2d;
        }
        
        .table-card.pending {
            background: #f8f4e6;
            border-left-color: #6b5b00;
        }
        
        .table-card.subtotal-row {
            background: #e9ecef;
            border-left-color: #495057;
        }
        
        .table-card.total-row {
            background: #7fb069;
            color: white;
            border-left-color: #5a8a4a;
        }
        
        .card-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            flex-wrap: wrap;
        }
        
        .card-label {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 2px;
            min-width: 80px;
        }
        
        .card-value {
            text-align: right;
            flex-grow: 1;
        }
        
        .card-component {
            font-weight: bold;
            font-size: 1.1em;
            margin-bottom: 10px;
            color: #7fb069;
        }
        
        .table-card.total-row .card-component,
        .table-card.total-row .card-label {
            color: white;
        }
        
        .status-indicator {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
            margin-right: 10px;
        }
        
        .status-complete {
            background: #e8f5e8;
            color: #2d5a2d;
        }
        
        .status-pending {
            background: #f8f4e6;
            color: #6b5b00;
        }
        
        .deliverables {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin: 20px 0;
        }
        
        .deliverable-item {
            background: #f0f7f0;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #7fb069;
        }
        
        .payment-schedule {
            background: #e8f0f7;
            color: #2c3e50;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 5px solid #7fb069;
        }
        
        .terms {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 1px solid #dee2e6;
        }
        
        .signature-section {
            display: block;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #dee2e6;
        }
        
        .signature-box {
            text-align: center;
            padding: 20px;
            border: 2px dashed #dee2e6;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .highlight {
            color: #7fb069;
            font-weight: bold;
        }
        
        .amount {
            color: #7fb069;
            font-weight: bold;
            font-size: 1.1em;
        }
        
        .editable-field {
            border: 1px solid #dee2e6;
            padding: 12px;
            border-radius: 4px;
            width: 100%;
            margin: 5px 0;
            font-family: inherit;
            font-size: 16px;
            background: white;
        }
        
        .editable-field:focus {
            outline: none;
            border-color: #7fb069;
            box-shadow: 0 0 0 2px rgba(127, 176, 105, 0.2);
        }
        
        .action-buttons {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
            border: 2px dashed #7fb069;
        }
        
        .btn {
            background: #7fb069;
            color: white;
            border: none;
            padding: 15px 20px;
            margin: 10px 5px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            text-decoration: none;
            display: inline-block;
            transition: all 0.3s ease;
            min-height: 48px;
            min-width: 120px;
        }
        
        .btn:hover {
            background: #6a9c5a;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(127, 176, 105, 0.3);
        }
        
        .btn-secondary {
            background: #6c757d;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
        }
        
        .btn-danger {
            background: #dc3545;
        }
        
        .btn-danger:hover {
            background: #c82333;
        }
        
        .signature-canvas {
            border: 2px solid #dee2e6;
            border-radius: 8px;
            background: white;
            margin: 10px 0;
            cursor: crosshair;
            max-width: 100%;
            height: auto;
        }
        
        .signature-controls {
            text-align: center;
            margin: 15px 0;
        }
        
        .signature-controls button {
            padding: 10px 15px;
            margin: 5px;
            font-size: 14px;
            min-height: 44px;
        }
        
        .signature-section-digital {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 1px solid #dee2e6;
        }
        
        .status-message {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            text-align: center;
            display: none;
        }
        
        .status-message.error {
            background: #f8d7da;
            color: #721c24;
        }
        
        .status-message.warning {
            background: #fff3cd;
            color: #856404;
        }
        
        .editable-label {
            font-weight: bold;
            color: #7fb069;
            margin-bottom: 5px;
            display: block;
        }
        
        .signature-date {
            margin-top: 15px;
            text-align: center;
        }
        
        .signature-date input {
            border: 1px solid #dee2e6;
            border-radius: 4px;
            background: white;
            text-align: center;
            width: 150px;
            padding: 8px;
            font-size: 14px;
        }
        
        @media print {
            .action-buttons, .no-print {
                display: none !important;
            }
            
            .editable-field {
                border: none;
                border-bottom: 1px solid #333;
                background: transparent;
            }
            
            body {
                margin: 0;
                padding: 0;
            }
            
            .container {
                box-shadow: none;
                margin: 0;
                padding: 20px;
            }
            
            .cost-table {
                display: table !important;
                font-size: 12px;
            }
            
            .table-cards {
                display: none !important;
            }
        }
        
        /* Mobile Specific Styles */
        @media (max-width: 768px) {
            body {
                padding: 5px;
            }
            
            .container {
                padding: 15px;
                border-radius: 5px;
            }
            
            .company-name {
                font-size: 1.5em;
            }
            
            .company-tagline {
                font-size: 0.9em;
            }
            
            .invoice-title {
                font-size: 1.5em;
            }
            
            .section-title {
                font-size: 1.3em;
            }
            
            .deliverables {
                grid-template-columns: 1fr;
            }
            
            .btn {
                display: block;
                width: 100%;
                margin: 10px 0;
                padding: 15px;
                font-size: 16px;
            }
            
            .signature-canvas {
                width: 100%;
                max-width: 100%;
            }
            
            .signature-section {
                display: block;
            }
            
            .signature-box {
                margin-bottom: 20px;
            }
        }
        
        /* Extra Small Screens */
        @media (max-width: 480px) {
            .container {
                padding: 10px;
            }
            
            .invoice-info, .bill-to, .bill-from, .project-overview, .payment-schedule, .terms {
                padding: 15px;
            }
            
            .company-name {
                font-size: 1.3em;
            }
            
            .invoice-title {
                font-size: 1.3em;
            }
            
            .section-title {
                font-size: 1.2em;
            }
            
            .signature-controls button {
                display: block;
                width: 100%;
                margin: 5px 0;
            }
        }
        
        /* Payment schedule table responsiveness */
        .payment-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        
        .payment-table td {
            padding: 10px;
            border-bottom: 1px solid #dee2e6;
            vertical-align: top;
        }
        
        @media (max-width: 768px) {
            .payment-table {
                display: none;
            }
            
            .payment-cards {
                display: block;
            }
            
            .payment-card {
                background: white;
                border: 1px solid #dee2e6;
                border-radius: 8px;
                padding: 15px;
                margin-bottom: 10px;
            }
            
            .payment-cards {
                display: none;
            }
        }
        
        .payment-cards {
            display: none;
        }
        
        /* Ensure touch-friendly interactions */
        @media (hover: none) and (pointer: coarse) {
            .btn {
                padding: 15px 20px;
                font-size: 16px;
            }
            
            .editable-field {
                font-size: 16px;
                padding: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="company-name">CLIFF OKIKO</div>
            <div class="company-tagline">Software Development & Digital Solutions</div>
        </div>

        <!-- Invoice Details -->
        <div class="invoice-details">
            <div class="invoice-info">
                <div class="invoice-title">INVOICE</div>
                <p><strong>Invoice Number:</strong> KG-LTR-2025-001</p>
                <p><strong>Date:</strong> September 21, 2025</p>
                <p><strong>Due Date:</strong> Upon Receipt</p>
            </div>
            
            <div class="bill-to">
                <h3 style="color: #7fb069; margin-bottom: 15px;">BILL TO:</h3>
                <label class="editable-label">Company Name:</label>
                <input type="text" class="editable-field" value="" placeholder="Enter company name" id="clientCompany">

                <label class="editable-label">Address:</label>
                <input type="text" class="editable-field" placeholder="Enter your address" id="clientAddress">
                
                <label class="editable-label">Email:</label>
                <input type="email" class="editable-field" placeholder="Enter your email" id="clientEmail">
                
                <label class="editable-label">Phone:</label>
                <input type="tel" class="editable-field" placeholder="Enter your phone number" id="clientPhone">
            </div>
            
            <div class="bill-from">
                <h3 style="color: #7fb069; margin-bottom: 10px;">FROM:</h3>
                <p><strong>Cliff Okiko</strong></p>
                <p style="display:none">Email: cliff.okiko@gmail.com</p>
                <p>Phone: +254 792 867 928</p>
                <p>Location: Nairobi, Kenya</p>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons no-print">
            <h3 style="color: #7fb069; margin-bottom: 15px;">📋 INVOICE COMPLETION STEPS</h3>
            
            <div style="background: #e8f5e8; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #7fb069;">
                <h4 style="color: #2d5a2d; margin-bottom: 10px;">📝 How to Complete & Share This Invoice:</h4>
                <ol style="color: #2d5a2d; margin-left: 20px; line-height: 1.6;">
                    <li><strong>Fill Required Fields:</strong> Enter your company details in the "BILL TO" section above</li>
                    <li><strong>Add Digital Signature:</strong> Sign in the signature pad below using your mouse or touch</li>
                    <li><strong>Share Signed Invoice:</strong> Click "Quick: PDF + Email" to send your signed invoice to us</li>
                </ol>
                <p style="color: #2d5a2d; font-style: italic; margin-top: 10px;">
                    ⚡ <strong>Quick Tip:</strong> The "Quick: PDF + Email" button will generate your signed invoice as PDF and open your email client with everything pre-filled!
                </p>
            </div>
            
            <div class="status-message" id="statusMessage"></div>
            
            <div style="text-align: center; margin: 20px 0;">
                <button class="btn" onclick="downloadAndEmail()" style="font-size: 16px; padding: 15px 30px;">
                    ⚡ Quick: PDF + Email
                </button>
                
                <button class="btn btn-secondary" onclick="generatePDF()">📄 Download as PDF</button>
                <button class="btn btn-secondary" onclick="printInvoice()">🖨️ Print Invoice</button>
            </div>
            
            <p style="text-align: center; color: #6c757d; font-size: 14px; margin-top: 15px;">
                <strong>Need help?</strong> Email cliff.okiko@gmail.com for assistance
            </p>
        </div>

        <!-- Digital Signature Section -->
        <div class="signature-section-digital no-print">
            <h3 style="color: #7fb069; margin-bottom: 15px;">✍️ DIGITAL SIGNATURE</h3>
            <p style="margin-bottom: 15px; color: #6c757d;">Client signs below to authorize this invoice digitally.</p>

            <!-- Client signature -->
            <div style="text-align: center;">
                <canvas id="signatureCanvas" class="signature-canvas" width="400" height="150"></canvas>
                <div class="signature-controls">
                    <button class="btn btn-secondary" onclick="clearSignature()">Clear Signature</button>
                    <button class="btn" onclick="saveSignature()">Save Signature</button>
                </div>
                <p style="font-size: 12px; color: #6c757d;">Client: sign above using your mouse or touch screen</p>
            </div>
        </div>

        <!-- Project Overview -->
        <div class="project-overview">
            <h2 style="margin-bottom: 15px; color: #7fb069;">PROJECT OVERVIEW</h2>
            <p><strong>Project:</strong> Letrum Travels - Complete Travel Agency Platform</p>
            <p><strong>Type:</strong> Full-Stack Responsive Website with Booking Systems</p>
            <p><strong>Technology Stack:</strong> Next.js, NestJS, PostgreSQL, TypeScript</p>
            <p><strong>Deployment:</strong> Frontend (Vercel) + Backend (Render)</p>
        </div>

        <!-- Scope of Work -->
        <h2 class="section-title">SCOPE OF WORK AS PER REQUIREMENTS</h2>
        
        <div class="deliverables">
            <div class="deliverable-item">
                <h4 style="color: #7fb069; margin-bottom: 10px;">1. Flight Booking Engine</h4>
                <p>Integration with flight APIs, search and compare prices, detailed flight information, secure booking and payment processing</p>
            </div>
            
            <div class="deliverable-item">
                <h4 style="color: #7fb069; margin-bottom: 10px;">2. Car Rental System</h4>
                <p>Advanced search by location, live availability, dynamic pricing, comprehensive booking summary</p>
            </div>
            
            <div class="deliverable-item">
                <h4 style="color: #7fb069; margin-bottom: 10px;">3. Visa Processing</h4>
                <p>Comprehensive application forms, document upload, admin dashboard, status tracking</p>
            </div>
            
            <div class="deliverable-item">
                <h4 style="color: #7fb069; margin-bottom: 10px;">4. Tour & Safari Packages</h4>
                <p>Stunning package galleries, detailed itineraries, advanced filtering, instant booking system</p>
            </div>
            
            <div class="deliverable-item">
                <h4 style="color: #7fb069; margin-bottom: 10px;">5. E-Commerce Platform</h4>
                <p>Complete travel products catalog, shopping cart, inventory management, order tracking</p>
            </div>
            
            <div class="deliverable-item">
                <h4 style="color: #7fb069; margin-bottom: 10px;">6. Client Account Management</h4>
                <p>User registration, booking history, visa status tracking, personal preferences</p>
            </div>
        </div>

        <!-- Cost Breakdown -->
        <h2 class="section-title">DETAILED COST BREAKDOWN</h2>
        
        <h3 style="color: #7fb069; margin: 20px 0 15px 0;">FRONTEND DEVELOPMENT (Next.js + TypeScript)</h3>
        
        <h4 style="margin: 15px 0 10px 0;">✅ COMPLETED WORK (30% Frontend Complete)</h4>
        
        <div class="cost-table-wrapper">
            <table class="cost-table">
                <thead>
                    <tr>
                        <th>Component</th>
                        <th>Hours</th>
                        <th>Rate (KSH)</th>
                        <th>Amount (KSH)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="completed">
                        <td>Project Setup & Base Architecture</td>
                        <td>4</td>
                        <td>1,300</td>
                        <td class="amount">5,200</td>
                    </tr>
                    <tr class="completed">
                        <td>Basic Landing Page Structure</td>
                        <td>4</td>
                        <td>1,300</td>
                        <td class="amount">5,200</td>
                    </tr>
                    <tr class="completed">
                        <td>Authentication UI Components</td>
                        <td>5</td>
                        <td>1,300</td>
                        <td class="amount">6,500</td>
                    </tr>
                    <tr class="completed">
                        <td>Dashboard Layout & Navigation</td>
                        <td>4</td>
                        <td>1,300</td>
                        <td class="amount">5,200</td>
                    </tr>
                    <tr class="completed">
                        <td>Basic Routing & Components Setup</td>
                        <td>3</td>
                        <td>1,300</td>
                        <td class="amount">3,900</td>
                    </tr>
                    <tr class="completed">
                        <td>Initial Flight Interface Framework</td>
                        <td>4</td>
                        <td>1,300</td>
                        <td class="amount">5,200</td>
                    </tr>
                    <tr class="completed">
                        <td>Tours Section Basic Layout</td>
                        <td>3</td>
                        <td>1,300</td>
                        <td class="amount">3,900</td>
                    </tr>
                    <tr class="subtotal-row">
                        <td colspan="3"><strong>Frontend Completed Subtotal:</strong></td>
                        <td class="amount"><strong>KSH 35,100</strong></td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <h4 style="margin: 15px 0 10px 0;">🔄 PENDING WORK (70% Frontend Remaining)</h4>
        
        <div class="cost-table-wrapper">
            <table class="cost-table">
                <thead>
                    <tr>
                        <th>Component</th>
                        <th>Hours</th>
                        <th>Rate (KSH)</th>
                        <th>Amount (KSH)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="pending">
                        <td>Complete Landing Page with Modern Effects</td>
                        <td>8</td>
                        <td>1,300</td>
                        <td class="amount">10,400</td>
                    </tr>
                    <tr class="pending">
                        <td>Flight Booking Interface & Search System</td>
                        <td>12</td>
                        <td>1,300</td>
                        <td class="amount">15,600</td>
                    </tr>
                    <tr class="pending">
                        <td>Car Rental Interface with Advanced Filtering</td>
                        <td>10</td>
                        <td>1,300</td>
                        <td class="amount">13,000</td>
                    </tr>
                    <tr class="pending">
                        <td>Premium Tours Gallery with Booking System</td>
                        <td>12</td>
                        <td>1,300</td>
                        <td class="amount">15,600</td>
                    </tr>
                    <tr class="pending">
                        <td>Visa Processing Forms & Document Upload</td>
                        <td>8</td>
                        <td>1,300</td>
                        <td class="amount">10,400</td>
                    </tr>
                    <tr class="pending">
                        <td>Complete E-commerce Platform & Shopping Cart</td>
                        <td>14</td>
                        <td>1,300</td>
                        <td class="amount">18,200</td>
                    </tr>
                    <tr class="pending">
                        <td>User Dashboard & Account Management</td>
                        <td>8</td>
                        <td>1,300</td>
                        <td class="amount">10,400</td>
                    </tr>
                    <tr class="pending">
                        <td>Admin Panel Frontend</td>
                        <td>10</td>
                        <td>1,300</td>
                        <td class="amount">13,000</td>
                    </tr>
                    <tr class="pending">
                        <td>Additional Pages (About, Contact, Blog)</td>
                        <td>6</td>
                        <td>1,300</td>
                        <td class="amount">7,800</td>
                    </tr>
                    <tr class="pending">
                        <td>Mobile Optimization & Responsive Design</td>
                        <td>10</td>
                        <td>1,300</td>
                        <td class="amount">13,000</td>
                    </tr>
                    <tr class="pending">
                        <td>Advanced Animations & Interactive Components</td>
                        <td>6</td>
                        <td>1,300</td>
                        <td class="amount">7,800</td>
                    </tr>
                    <tr class="pending">
                        <td>Payment Gateway Frontend Integration</td>
                        <td>6</td>
                        <td>1,300</td>
                        <td class="amount">7,800</td>
                    </tr>
                    <tr class="subtotal-row">
                        <td colspan="3"><strong>Frontend Pending Subtotal:</strong></td>
                        <td class="amount"><strong>KSH 163,000</strong></td>
                    </tr>
                    <tr class="total-row">
                        <td colspan="3"><strong>Frontend Total:</strong></td>
                        <td><strong>KSH 198,100</strong></td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Backend Development -->
        <h3 style="color: #7fb069; margin: 30px 0 15px 0;">BACKEND DEVELOPMENT (NestJS + PostgreSQL)</h3>
        
        <h4 style="margin: 15px 0 10px 0;">✅ COMPLETED WORK (80% Backend Complete)</h4>
        <div class="cost-table-wrapper">
            <table class="cost-table">
                <thead>
                    <tr>
                        <th>Component</th>
                        <th>Hours</th>
                        <th>Rate (KSH)</th>
                        <th>Amount (KSH)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="completed">
                        <td>RESTful API Architecture & Setup</td>
                        <td>6</td>
                        <td>1,300</td>
                        <td class="amount">7,800</td>
                    </tr>
                    <tr class="completed">
                        <td>JWT Authentication with Role-Based Access</td>
                        <td>6</td>
                        <td>1,300</td>
                        <td class="amount">7,800</td>
                    </tr>
                    <tr class="completed">
                        <td>PostgreSQL Database Design with Prisma ORM</td>
                        <td>6</td>
                        <td>1,300</td>
                        <td class="amount">7,800</td>
                    </tr>
                    <tr class="completed">
                        <td>User Management System (USER, ADMIN, STAFF)</td>
                        <td>5</td>
                        <td>1,300</td>
                        <td class="amount">6,500</td>
                    </tr>
                    <tr class="completed">
                        <td>Tours & Safari Management API</td>
                        <td>8</td>
                        <td>1,300</td>
                        <td class="amount">10,400</td>
                    </tr>
                    <tr class="completed">
                        <td>Flight Management System API</td>
                        <td>7</td>
                        <td>1,300</td>
                        <td class="amount">9,100</td>
                    </tr>
                    <tr class="completed">
                        <td>Car Rental Management API</td>
                        <td>7</td>
                        <td>1,300</td>
                        <td class="amount">9,100</td>
                    </tr>
                    <tr class="completed">
                        <td>Visa Processing Backend System</td>
                        <td>6</td>
                        <td>1,300</td>
                        <td class="amount">7,800</td>
                    </tr>
                    <tr class="completed">
                        <td>E-commerce Backend & Inventory Management</td>
                        <td>10</td>
                        <td>1,300</td>
                        <td class="amount">13,000</td>
                    </tr>
                    <tr class="completed">
                        <td>Comprehensive Data Models & Relationships</td>
                        <td>5</td>
                        <td>1,300</td>
                        <td class="amount">6,500</td>
                    </tr>
                    <tr class="completed">
                        <td>API Documentation with Swagger/OpenAPI</td>
                        <td>4</td>
                        <td>1,300</td>
                        <td class="amount">5,200</td>
                    </tr>
                    <tr class="completed">
                        <td>Data Validation with Class-Validator</td>
                        <td>3</td>
                        <td>1,300</td>
                        <td class="amount">3,900</td>
                    </tr>
                    <tr class="completed">
                        <td>CORS Configuration & Security Setup</td>
                        <td>3</td>
                        <td>1,300</td>
                        <td class="amount">3,900</td>
                    </tr>
                    <tr class="completed">
                        <td>Database Migrations & Seeding</td>
                        <td>4</td>
                        <td>1,300</td>
                        <td class="amount">5,200</td>
                    </tr>
                    <tr class="subtotal-row">
                        <td colspan="3"><strong>Backend Completed Subtotal:</strong></td>
                        <td class="amount"><strong>KSH 119,900</strong></td>
                    </tr>
                </tbody>
            </table>
            
        </div>
        
        <h4 style="margin: 15px 0 10px 0;">🔄 PENDING WORK (20% Backend Remaining)</h4>
        <div class="cost-table-wrapper">
            <table class="cost-table">
                <thead>
                    <tr>
                        <th>Component</th>
                        <th>Hours</th>
                        <th>Rate (KSH)</th>
                        <th>Amount (KSH)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="pending">
                        <td>Live Flight API Integration (Amadeus/Skyscanner)</td>
                        <td>6</td>
                        <td>1,300</td>
                        <td class="amount">7,800</td>
                    </tr>
                    <tr class="pending">
                        <td>Payment Gateway Backend Integration</td>
                        <td>5</td>
                        <td>1,300</td>
                        <td class="amount">6,500</td>
                    </tr>
                    <tr class="pending">
                        <td>Email Notification System Setup</td>
                        <td>4</td>
                        <td>1,300</td>
                        <td class="amount">5,200</td>
                    </tr>
                    <tr class="pending">
                        <td>Admin Panel Backend Enhancements</td>
                        <td>3</td>
                        <td>1,300</td>
                        <td class="amount">3,900</td>
                    </tr>
                    <tr class="pending">
                        <td>Performance Optimization & Caching</td>
                        <td>2</td>
                        <td>1,300</td>
                        <td class="amount">2,600</td>
                    </tr>
                    <tr class="subtotal-row">
                        <td colspan="3"><strong>Backend Pending Subtotal:</strong></td>
                        <td class="amount"><strong>KSH 26,000</strong></td>
                    </tr>
                    <tr class="total-row">
                        <td colspan="3"><strong>Backend Total:</strong></td>
                        <td><strong>KSH 145,900</strong></td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Integration & Deployment -->
        <h3 style="color: #7fb069; margin: 30px 0 15px 0;">INTEGRATION & DEPLOYMENT</h3>
        
        <div class="cost-table-wrapper">
            <table class="cost-table">
                <thead>
                    <tr>
                        <th>Component</th>
                        <th>Hours</th>
                        <th>Rate (KSH)</th>
                        <th>Amount (KSH)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="completed">
                        <td>Development Environment Setup</td>
                        <td>3</td>
                        <td>1,300</td>
                        <td class="amount">3,900</td>
                    </tr>
                    <tr class="completed">
                        <td>Basic Frontend-Backend Connection</td>
                        <td>3</td>
                        <td>1,300</td>
                        <td class="amount">3,900</td>
                    </tr>
                    <tr class="completed">
                        <td>API Testing & Documentation</td>
                        <td>2</td>
                        <td>1,300</td>
                        <td class="amount">2,600</td>
                    </tr>
                    <tr class="subtotal-row">
                        <td colspan="3"><strong>Integration Completed Subtotal:</strong></td>
                        <td class="amount"><strong>KSH 10,400</strong></td>
                    </tr>
                    <tr class="pending">
                        <td>Complete Frontend-Backend Integration</td>
                        <td>6</td>
                        <td>1,300</td>
                        <td class="amount">7,800</td>
                    </tr>
                    <tr class="pending">
                        <td>Vercel Deployment Setup (Frontend)</td>
                        <td>3</td>
                        <td>1,300</td>
                        <td class="amount">3,900</td>
                    </tr>
                    <tr class="pending">
                        <td>Render Deployment Setup (Backend)</td>
                        <td>3</td>
                        <td>1,300</td>
                        <td class="amount">3,900</td>
                    </tr>
                    <tr class="pending">
                        <td>Production Environment Configuration</td>
                        <td>3</td>
                        <td>1,300</td>
                        <td class="amount">3,900</td>
                    </tr>
                    <tr class="pending">
                        <td>Comprehensive Quality Assurance & Testing</td>
                        <td>6</td>
                        <td>1,300</td>
                        <td class="amount">7,800</td>
                    </tr>
                    <tr class="pending">
                        <td>Documentation & Client Handover</td>
                        <td>3</td>
                        <td>1,300</td>
                        <td class="amount">3,900</td>
                    </tr>
                    <tr class="subtotal-row">
                        <td colspan="3"><strong>Integration Pending Subtotal:</strong></td>
                        <td class="amount"><strong>KSH 31,200</strong></td>
                    </tr>
                    <tr class="total-row">
                        <td colspan="3"><strong>Integration & Deployment Total:</strong></td>
                        <td><strong>KSH 41,600</strong></td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Project Cost Summary -->
        <div class="payment-schedule">
            <h2 style="margin-bottom: 20px; color: #7fb069;">PROJECT COST SUMMARY</h2>
            <p><strong>Frontend Development:</strong> <span class="highlight">KSH 198,100</span></p>
            <p><strong>Backend Development:</strong> <span class="highlight">KSH 145,900</span></p>
            <p><strong>Integration & Deployment:</strong> <span class="highlight">KSH 41,600</span></p>
            <hr style="margin: 15px 0; border: 1px solid #dee2e6;">
            <p><strong>Total Project Cost:</strong> <span class="highlight">KSH 385,600</span></p>
            <p><strong>Professional Discount (Applied):</strong> <span class="highlight">-KSH 70,000</span></p>
            <p><strong>Adjusted Subtotal:</strong> <span class="highlight">KSH 315,600</span></p>
            <p><strong>VAT (16%):</strong> <span class="highlight">KSH 50,496</span></p>
            <hr style="margin: 15px 0; border: 2px solid #7fb069;">
            <h3 style="color: #7fb069;"><strong>Final Amount: KSH 366,096</strong></h3>
            <p style="margin-top: 15px;"><strong>Client-Friendly Pricing:</strong> <span class="highlight">KSH 180,000</span></p>
            <p><strong>Additional Project Discount:</strong> <span class="highlight">-KSH 186,096</span></p>
            <hr style="margin: 15px 0; border: 2px solid #7fb069;">
            <h3 style="color: #7fb069;"><strong>TOTAL AMOUNT: KSH 180,000</strong></h3>
        </div>

        <!-- Work Completion Status -->
        <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin: 20px 0;">
            <h3 style="color: #7fb069; margin-bottom: 15px;">WORK COMPLETION STATUS</h3>
            <p><span class="status-indicator status-complete">✅ Completed Work:</span> 65% (Backend 80% complete, Frontend 30% complete, Integration 40% complete)</p>
            <p><span class="status-indicator status-pending">🔄 Remaining Work:</span> 35% (Frontend completion, final integrations, deployment)</p>
            <p><em>This pricing reflects substantial development work completed and provides exceptional value for a comprehensive travel platform.</em></p>
        </div>

        <!-- Timeline -->
        <h2 class="section-title">PROJECT TIMELINE</h2>
        
        <div style="background: #f0f7f0; padding: 20px; border-radius: 10px; margin: 20px 0;">
            <h3 style="color: #7fb069; margin-bottom: 15px;">Current Status: 65% Complete</h3>
            
            <div class="cost-table-wrapper">
                <table class="cost-table">
                    <thead>
                        <tr>
                            <th>Phase</th>
                            <th>Status</th>
                            <th>Deliverable</th>
                            <th>Timeline</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="completed">
                            <td><strong>✅ Phase 1: Foundation</strong></td>
                            <td>COMPLETED</td>
                            <td>Project setup, database design, API architecture</td>
                            <td>Completed</td>
                        </tr>
                        <tr class="completed">
                            <td><strong>✅ Phase 2: Backend Development</strong></td>
                            <td>80% COMPLETE</td>
                            <td>API development, authentication, database models</td>
                            <td>Mostly Complete</td>
                        </tr>
                        <tr class="pending">
                            <td><strong>🔄 Phase 3: Frontend Development</strong></td>
                            <td>30% COMPLETE</td>
                            <td>User interfaces, booking systems, responsive design</td>
                            <td>3-4 weeks remaining</td>
                        </tr>
                        <tr class="pending">
                            <td><strong>🔄 Phase 4: Integration & Testing</strong></td>
                            <td>40% COMPLETE</td>
                            <td>API integrations, payment gateway, testing</td>
                            <td>1-2 weeks remaining</td>
                        </tr>
                        <tr class="pending">
                            <td><strong>🔄 Phase 5: Deployment & Handover</strong></td>
                            <td>PENDING</td>
                            <td>Live deployment, documentation, training</td>
                            <td>1 week</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <h4 style="margin: 20px 0 10px 0; color: #7fb069;">Remaining Duration: 6 weeks from contract signing to live deployment</h4>
            
            <h4 style="margin: 15px 0 10px 0;">Detailed Remaining Work Schedule:</h4>
            <ul style="margin-left: 20px;">
                <li><strong>Weeks 1-3:</strong> Complete frontend development (all booking interfaces, e-commerce, admin panel)</li>
                <li><strong>Week 4-5:</strong> API integrations (flight APIs, payment gateways, email system)</li>
                <li><strong>Week 6:</strong> Final testing, deployment setup, and client handover</li>
            </ul>
        </div>

        <!-- Payment Schedule -->
        <div class="payment-schedule">
            <h2 style="margin-bottom: 20px; color: #7fb069;">PAYMENT SCHEDULE</h2>
            <p><em>Based on 65% work completion status</em></p>
            <br>
            
            <!-- Desktop Payment Table -->
            <table class="payment-table" style="width: 100%; color: #2c3e50;">
                <tr style="border-bottom: 1px solid #dee2e6;">
                    <td style="padding: 10px;"><strong>Contract Signing & Project Initiation</strong></td>
                    <td style="padding: 10px;"><strong>50%</strong></td>
                    <td style="padding: 10px;"><strong>KSH 90,000</strong></td>
                    <td style="padding: 10px;"><strong>Upon Agreement</strong></td>
                </tr>
                <tr style="border-bottom: 1px solid #dee2e6;">
                    <td style="padding: 10px;"><strong>Frontend Development Completion</strong></td>
                    <td style="padding: 10px;"><strong>30%</strong></td>
                    <td style="padding: 10px;"><strong>KSH 54,000</strong></td>
                    <td style="padding: 10px;"><strong>Week 3-4 (Frontend Demo)</strong></td>
                </tr>
                <tr>
                    <td style="padding: 10px;"><strong>Live Deployment & Project Handover</strong></td>
                    <td style="padding: 10px;"><strong>20%</strong></td>
                    <td style="padding: 10px;"><strong>KSH 36,000</strong></td>
                    <td style="padding: 10px;"><strong>Week 6 (Go-Live)</strong></td>
                </tr>
            </table>
            
            <!-- Mobile Payment Cards -->
            <div class="payment-cards">
                <div class="payment-card">
                    <h4 style="color: #7fb069; margin-bottom: 10px;">Contract Signing & Project Initiation</h4>
                    <div class="card-row">
                        <span class="card-label">Percentage:</span>
                        <span class="card-value"><strong>50%</strong></span>
                    </div>
                    <div class="card-row">
                        <span class="card-label">Amount:</span>
                        <span class="card-value amount"><strong>KSH 90,000</strong></span>
                    </div>
                    <div class="card-row">
                        <span class="card-label">Timeline:</span>
                        <span class="card-value"><strong>Upon Agreement</strong></span>
                    </div>
                </div>
                
                <div class="payment-card">
                    <h4 style="color: #7fb069; margin-bottom: 10px;">Frontend Development Completion</h4>
                    <div class="card-row">
                        <span class="card-label">Percentage:</span>
                        <span class="card-value"><strong>30%</strong></span>
                    </div>
                    <div class="card-row">
                        <span class="card-label">Amount:</span>
                        <span class="card-value amount"><strong>KSH 54,000</strong></span>
                    </div>
                    <div class="card-row">
                        <span class="card-label">Timeline:</span>
                        <span class="card-value"><strong>Week 3-4 (Frontend Demo)</strong></span>
                    </div>
                </div>
                
                <div class="payment-card">
                    <h4 style="color: #7fb069; margin-bottom: 10px;">Live Deployment & Project Handover</h4>
                    <div class="card-row">
                        <span class="card-label">Percentage:</span>
                        <span class="card-value"><strong>20%</strong></span>
                    </div>
                    <div class="card-row">
                        <span class="card-label">Amount:</span>
                        <span class="card-value amount"><strong>KSH 36,000</strong></span>
                    </div>
                    <div class="card-row">
                        <span class="card-label">Timeline:</span>
                        <span class="card-value"><strong>Week 6 (Go-Live)</strong></span>
                    </div>
                </div>
            </div>
            
            <br>
            <p><strong>Delivery Timeline:</strong> 6 weeks from contract signing to live deployment</p>
        </div>

        <!-- Deliverables -->
        <h2 class="section-title">COMPLETE DELIVERABLES</h2>
        
        <div style="background: #f0f7f0; padding: 20px; border-radius: 10px; margin: 20px 0;">
            <h3 style="color: #7fb069; margin-bottom: 15px;">✅ COMPLETED & READY FOR REVIEW (65% Complete):</h3>
            <div class="deliverables">
                <div class="deliverable-item">
                    <p>✅ <strong>Backend API Architecture</strong> - Complete RESTful API with all endpoints</p>
                </div>
                <div class="deliverable-item">
                    <p>✅ <strong>Database Design</strong> - PostgreSQL with Prisma ORM and comprehensive relationships</p>
                </div>
                <div class="deliverable-item">
                    <p>✅ <strong>Authentication System</strong> - JWT-based login with role management</p>
                </div>
                <div class="deliverable-item">
                    <p>✅ <strong>API Documentation</strong> - Swagger/OpenAPI documentation</p>
                </div>
                <div class="deliverable-item">
                    <p>✅ <strong>Core Data Models</strong> - All booking systems backend</p>
                </div>
                <div class="deliverable-item">
                    <p>✅ <strong>Frontend Foundation</strong> - Basic structure and navigation</p>
                </div>
            </div>
            
            <h3 style="color: #7fb069; margin: 25px 0 15px 0;">🔄 IN DEVELOPMENT (35% Remaining):</h3>
            <div class="deliverables">
                <div class="deliverable-item">
                    <p>🔄 <strong>Complete Frontend Interfaces</strong> - All booking systems and dashboards</p>
                </div>
                <div class="deliverable-item">
                    <p>🔄 <strong>Flight API Integration</strong> - Live connection to Amadeus/Skyscanner</p>
                </div>
                <div class="deliverable-item">
                    <p>🔄 <strong>Payment Gateway</strong> - M-Pesa and card payment processing</p>
                </div>
                <div class="deliverable-item">
                    <p>🔄 <strong>Email Notifications</strong> - Booking confirmations and updates</p>
                </div>
                <div class="deliverable-item">
                    <p>🔄 <strong>Production Deployment</strong> - Vercel + Render hosting setup</p>
                </div>
                <div class="deliverable-item">
                    <p>🔄 <strong>Final Testing</strong> - Cross-browser testing and optimization</p>
                </div>
            </div>
        </div>

        <!-- Terms & Conditions -->
        <div class="terms">
            <h2 style="color: #7fb069; margin-bottom: 20px;">TERMS & CONDITIONS</h2>
            
            <h4 style="margin: 15px 0 10px 0;">Project Scope:</h4>
            <ul style="margin-left: 20px;">
                <li>Development begins upon receipt of 50% deposit</li>
                <li>Changes to scope will be quoted separately</li>
                <li>Client provides all necessary content, images, and API credentials</li>
                <li>Final payment required before go-live deployment</li>
            </ul>
            
            <h4 style="margin: 15px 0 10px 0;">Intellectual Property:</h4>
            <ul style="margin-left: 20px;">
                <li>Complete source code ownership transfers to client upon full payment</li>
                <li>Client receives all documentation and deployment guides</li>
                <li>Kejani Garage retains right to use project in portfolio</li>
            </ul>
            
            <h4 style="margin: 15px 0 10px 0;">Post-Delivery Support:</h4>
            <ul style="margin-left: 20px;">
                <li><strong>Included (7 Days):</strong> Bug fixes, deployment assistance, basic training</li>
                <li><strong>Optional Plans:</strong> KSH 15,000-40,000/month for ongoing support</li>
            </ul>
        </div>

        <!-- Bank Details -->
        <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin: 20px 0;">
            <h3 style="color: #7fb069; margin-bottom: 15px;">PAYMENT DETAILS</h3>
            <div style="display: block;">
                <div style="margin-bottom: 20px;">
                    <h4>Bank Transfer:</h4>
                    <p>Account Name: Cliff Okiko<br>
                    Bank: [Bank Name]<br>
                    Account Number: [Account Number]<br>
                    Branch: [Branch Code]</p>
                </div>
                <div>
                    <h4>Mobile Money:</h4>
                    <p>M-Pesa Send Money: [0792867928]<br>
                    Account: [Cliff Okiko]</p>
                </div>
            </div>
        </div>

        <!-- Signatures -->
        <div class="signature-section">
            <div class="signature-box">
                <h4 style="margin-bottom: 20px;">CLIENT AUTHORIZATION</h4>
                <div id="clientSignatureDisplay" style="min-height: 60px; border-bottom: 1px solid #333; margin: 10px 0; position: relative;">
                    <img id="clientSignatureImg" style="max-height: 50px; max-width: 200px; display: none;" />
                    <span id="signaturePlaceholder" style="color: #ccc; font-style: italic;">Digital signature will appear here</span>
                </div>
                <div class="signature-date">
                    <label>Date: </label>
                    <input type="date" id="clientDate" class="editable-field" style="width: auto; display: inline-block;">
                </div>
                <p style="margin-top: 15px;"><strong><span id="displayClientCompany"></span></strong></p>
            </div>
            
            <div class="signature-box">
                <h4 style="margin-bottom: 20px;">PROVIDER AUTHORIZATION</h4>
                <div id="providerAuthDisplay">
                    <p style="margin: 0 0 8px 0;"><strong>Cliff Okiko</strong></p>
                    <div style="min-height: 40px; margin-bottom: 8px;">
                        <img id="providerSignatureImg" style="max-height: 50px; max-width: 220px; display: none;" />
                    </div>
                    <p id="providerEmailLabel" style="font-size: 12px; color: #6c757d; margin: 0;">cliff.okiko@gmail.com</p>
                </div>
                <div class="signature-date">
                    <label>Date: </label>
                    <input type="date" value="2025-09-21" class="editable-field" style="width: auto; display: inline-block;">
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div style="text-align: center; margin-top: 40px; padding: 20px; background: #f8f9fa; border-radius: 10px;">
            <h3 style="color: #7fb069; margin-bottom: 20px;">📋 Invoice Completion Instructions</h3>
            
            <div style="background: white; padding: 20px; border-radius: 8px; margin: 20px 0; border: 1px solid #dee2e6;">
                <h4 style="color: #2c3e50; margin-bottom: 15px;">🚀 3 Simple Steps to Complete Your Invoice:</h4>
                
                <div style="text-align: left;">
                    <div style="padding: 15px; background: #f8f9fa; border-radius: 6px; border-left: 4px solid #7fb069; margin-bottom: 15px;">
                        <h5 style="color: #7fb069; margin-bottom: 8px;">STEP 1: Fill Details</h5>
                        <p style="font-size: 14px; color: #2c3e50; margin: 0;">Complete your company information in the "BILL TO" section at the top of this invoice</p>
                    </div>
                    
                    <div style="padding: 15px; background: #f8f9fa; border-radius: 6px; border-left: 4px solid #7fb069; margin-bottom: 15px;">
                        <h5 style="color: #7fb069; margin-bottom: 8px;">STEP 2: Digital Sign</h5>
                        <p style="font-size: 14px; color: #2c3e50; margin: 0;">Use the signature pad above to sign digitally with your mouse or touch screen</p>
                    </div>
                    
                    <div style="padding: 15px; background: #f8f9fa; border-radius: 6px; border-left: 4px solid #7fb069;">
                        <h5 style="color: #7fb069; margin-bottom: 8px;">STEP 3: Send Invoice</h5>
                        <p style="font-size: 14px; color: #2c3e50; margin: 0;">Click "Quick: PDF + Email" to generate and share your signed invoice automatically</p>
                    </div>
                </div>
            </div>
            
            <div style="background: #e8f5e8; padding: 15px; border-radius: 8px; margin: 20px 0;">
                <p style="color: #2d5a2d; margin: 0; font-weight: bold;">
                    ⚡ The "Quick: PDF + Email" button will create your signed invoice as a PDF and open your email client 
                    with Cliff Okiko's email addresses pre-filled. Simply attach the downloaded PDF and send!
                </p>
            </div>
            
            <h4 style="color: #7fb069; margin-top: 30px;">Thank you for choosing Cliff Okiko for your software development needs.</h4>
            <p style="color: #6c757d; margin-top: 10px;"><em>This proposal is valid for 30 days from the date of issue. Project timeline begins upon receipt of initial payment and required project materials.</em></p>
            
            <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #dee2e6;">
                <p style="color: #6c757d; font-size: 14px;">
                    <strong>Need Help?</strong> Email cliff.okiko@gmail.com | Phone: +254 792 867 928
                </p>
            </div>
        </div>
    </div>

    <script>
    let signaturePad; // client signature pad
    let hasSignature = false;
    let providerSignatureDataUrl = null; // hardcoded provider signature image data url

        // Initialize signature pad
        function initSignaturePad() {
            // Client signature pad
            const canvas = document.getElementById('signatureCanvas');
            signaturePad = new SignaturePad(canvas, {
                backgroundColor: 'rgb(255, 255, 255)',
                penColor: 'rgb(0, 0, 0)',
                minWidth: 1,
                maxWidth: 3,
                throttle: 16,
                minDistance: 5,
                onBegin: function() {
                    document.getElementById('signaturePlaceholder').style.display = 'none';
                }
            });

            // Generate and insert hardcoded provider signature image
            createProviderSignatureImage();
            
            // Resize canvas for mobile on load
            resizeCanvas();
        }

        // Auto-update company name in signature section
        document.getElementById('clientCompany').addEventListener('input', function() {
            document.getElementById('displayClientCompany').textContent = this.value || 'Letrum Agencies';
        });

        // Set today's date as default for client signature
        document.getElementById('clientDate').valueAsDate = new Date();

        // Show status message
        function showStatus(message, type = 'success') {
            const statusEl = document.getElementById('statusMessage');
            statusEl.textContent = message;
            statusEl.className = `status-message ${type}`;
            statusEl.style.display = 'block';
            
            setTimeout(() => {
                statusEl.style.display = 'none';
            }, 3000);
        }

        // Generate PDF function (individual use)
        function generatePDF() {
            const clientCompany = document.getElementById('clientCompany').value || 'Client';

            showStatus('📄 Generating PDF... Please wait...', 'warning');

            // Create a cleaned clone to remove helper UI and signature canvases
            const original = document.querySelector('.container');
            const clone = original.cloneNode(true);

            // Remove interactive/helper sections from clone
            const helpers = clone.querySelectorAll('.no-print, .action-buttons, .signature-section-digital, .signature-controls');
            helpers.forEach(h => h.remove());

            // Replace provider and client canvases with their saved images if available
            const provImgSrc = providerSignatureDataUrl || (document.getElementById('providerSignatureImg') ? document.getElementById('providerSignatureImg').src : null);
            const clientImgSrc = (hasSignature && document.getElementById('clientSignatureImg')) ? document.getElementById('clientSignatureImg').src : null;

            // Provider signature spot in cloned provider authorization
            const provDisplay = clone.querySelector('#providerAuthDisplay');
            if (provDisplay) {
                // remove any canvas inside and insert image
                const existingCanv = provDisplay.querySelector('canvas');
                if (existingCanv) existingCanv.remove();
                const pimg = provDisplay.querySelector('#providerSignatureImg') || document.createElement('img');
                pimg.id = 'providerSignatureImg';
                if (provImgSrc) {
                    pimg.src = provImgSrc;
                    pimg.style.display = 'block';
                } else {
                    pimg.style.display = 'none';
                }
                provDisplay.insertBefore(pimg, provDisplay.firstChild);
            }

            // Client signature spot in cloned client authorization
            const clientDisplay = clone.querySelector('#clientSignatureDisplay');
            if (clientDisplay) {
                const cimg = clientDisplay.querySelector('#clientSignatureImg') || document.createElement('img');
                cimg.id = 'clientSignatureImg';
                if (clientImgSrc) {
                    cimg.src = clientImgSrc;
                    cimg.style.display = 'block';
                } else {
                    cimg.style.display = 'none';
                }
                // remove canvas placeholders
                const canv = clone.querySelector('#signatureCanvas');
                if (canv) canv.remove();
                clientDisplay.insertBefore(cimg, clientDisplay.firstChild);
            }

            const opt = {
                margin: 0.3,
                filename: `Invoice_${clientCompany.replace(/\s+/g, '_')}.pdf`,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2, useCORS: true },
                jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
            };

            // Generate PDF from the cleaned clone appended to body temporarily
            const wrapper = document.createElement('div');
            wrapper.style.padding = '20px';
            wrapper.appendChild(clone);
            document.body.appendChild(wrapper);

            // Return the promise so callers can chain actions (e.g., open email after save)
            const pdfPromise = html2pdf().set(opt).from(wrapper).save()
                .then(() => {
                    showStatus('✅ PDF downloaded successfully!', 'success');
                    wrapper.remove();
                }).catch(() => {
                    showStatus('❌ Error generating PDF. Please try again.', 'error');
                    wrapper.remove();
                    throw new Error('PDF generation failed');
                });

            return pdfPromise;
        }

        // Print invoice function
        function printInvoice() {
            if (!hasSignature) {
                showStatus('❌ Please add your digital signature before printing', 'warning');
                return;
            }
            
            showStatus('🖨️ Opening print dialog...', 'success');
            window.print();
        }

        // Save data function
        function saveData() {
            const data = {
                company: document.getElementById('clientCompany').value,
                address: document.getElementById('clientAddress').value,
                email: document.getElementById('clientEmail').value,
                phone: document.getElementById('clientPhone').value,
                date: document.getElementById('clientDate').value,
                signature: hasSignature ? signaturePad.toDataURL() : null,
                timestamp: new Date().toISOString()
            };

            localStorage.setItem('letrum_invoice_data', JSON.stringify(data));
            showStatus('Details saved successfully!', 'success');
        }

        // Reset form function
        function resetForm() {
            if (confirm('Are you sure you want to reset all fields? This will clear all entered data.')) {
                // Clear all input fields
                document.getElementById('clientCompany').value = '';
                document.getElementById('clientAddress').value = '';
                document.getElementById('clientEmail').value = '';
                document.getElementById('clientPhone').value = '';
                document.getElementById('clientDate').valueAsDate = new Date();
                
                // Clear signature
                clearSignature();
                
                // Update display
                document.getElementById('displayClientCompany').textContent = '';
                
                // Clear saved data
                localStorage.removeItem('letrum_invoice_data');
                
                showStatus('Form reset successfully!', 'success');
            }
        }

        // Load saved data function
        function loadSavedData() {
            const savedData = localStorage.getItem('letrum_invoice_data');
            if (savedData) {
                const data = JSON.parse(savedData);
                document.getElementById('clientCompany').value = data.company || '';
                document.getElementById('clientAddress').value = data.address || '';
                document.getElementById('clientEmail').value = data.email || '';
                document.getElementById('clientPhone').value = data.phone || '';
                if (data.date) {
                    document.getElementById('clientDate').value = data.date;
                }
                
                // Load signature if exists
                if (data.signature) {
                    signaturePad.fromDataURL(data.signature);
                    hasSignature = true;
                    document.getElementById('clientSignatureImg').src = data.signature;
                    document.getElementById('clientSignatureImg').style.display = 'block';
                    document.getElementById('signaturePlaceholder').style.display = 'none';
                }

                // Provider signature is generated programmatically on load
                createProviderSignatureImage();
                
                // Update display name
                document.getElementById('displayClientCompany').textContent = data.company || '';
                
                showStatus('Saved data loaded successfully!', 'success');
            } else {
                showStatus('No saved data found', 'warning');
            }
        }

        // Clear signature function
        function clearSignature() {
            signaturePad.clear();
            hasSignature = false;
            document.getElementById('clientSignatureImg').style.display = 'none';
            document.getElementById('signaturePlaceholder').style.display = 'inline';
            showStatus('Signature cleared', 'success');
        }

        // Create a hardcoded, stylized provider signature image from the name
        function createProviderSignatureImage() {
            const name = 'Cliff Okiko';
            // create canvas
            const canvas = document.createElement('canvas');
            canvas.width = 600;
            canvas.height = 160;
            const ctx = canvas.getContext('2d');
            // background transparent
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            // stylized text
            ctx.fillStyle = '#0b3d0b';
            ctx.font = '48px "Great Vibes", "Brush Script MT", "Pacifico", cursive';
            ctx.textBaseline = 'middle';
            // center text
            const textWidth = ctx.measureText(name).width;
            ctx.fillText(name, (canvas.width - textWidth) / 2, canvas.height / 2 + 10);
            // slight underline flourish
            ctx.strokeStyle = 'rgba(11,61,11,0.7)';
            ctx.lineWidth = 2.5;
            ctx.beginPath();
            ctx.moveTo((canvas.width - textWidth) / 2 + 10, canvas.height / 2 + 30);
            ctx.quadraticCurveTo(canvas.width / 2, canvas.height / 2 + 50, (canvas.width + textWidth) / 2 - 10, canvas.height / 2 + 30);
            ctx.stroke();

            const dataUrl = canvas.toDataURL('image/png');
            providerSignatureDataUrl = dataUrl;

            const img = document.getElementById('providerSignatureImg');
            if (img) {
                img.src = dataUrl;
                img.style.display = 'block';
            }
        }

        // Save signature function
        function saveSignature() {
            if (signaturePad.isEmpty()) {
                showStatus('Please provide a signature first', 'warning');
                return;
            }

            hasSignature = true;
            const signatureImage = signaturePad.toDataURL();
            
            // Display signature in the signature section
            document.getElementById('clientSignatureImg').src = signatureImage;
            document.getElementById('clientSignatureImg').style.display = 'block';
            document.getElementById('signaturePlaceholder').style.display = 'none';
            
            showStatus('Signature saved successfully!', 'success');
        }

        // Enhanced download and email function (main action)
        function downloadAndEmail() {
            // Validation checks
            const clientCompany = document.getElementById('clientCompany').value;
            const clientEmail = document.getElementById('clientEmail').value;
            const clientAddress = document.getElementById('clientAddress').value;
            const clientPhone = document.getElementById('clientPhone').value;

            // Check required fields
            if (!clientCompany || clientCompany === 'Letrum Agencies') {
                showStatus('❌ Please enter your company name', 'error');
                document.getElementById('clientCompany').focus();
                return;
            }
            if (!clientEmail) {
                showStatus('❌ Please enter your email address', 'error');
                document.getElementById('clientEmail').focus();
                return;
            }
            if (!clientAddress) {
                showStatus('❌ Please enter your company address', 'error');
                document.getElementById('clientAddress').focus();
                return;
            }
            if (!clientPhone) {
                showStatus('❌ Please enter your phone number', 'error');
                document.getElementById('clientPhone').focus();
                return;
            }
            if (!hasSignature) {
                showStatus('❌ Please add your digital signature before proceeding', 'error');
                return;
            }

            showStatus('⚡ Generating your signed invoice PDF...', 'warning');

            // Use generatePDF which returns a promise
            generatePDF().then(() => {
                // After PDF is ready, open detailed email body
                setTimeout(function() {
                        var recipients = ['cliff.okiko@gmail.com', 'muthaigasam222@gmail.com'];
                        var subject = `✅ SIGNED INVOICE - ${clientCompany} - Letrum Travel Platform Development`;
                        var currentURL = window.location.href;
                        var timestamp = new Date().toISOString().replace(/[:.]/g, '-');

                        // Build body with real newlines then encode once via URLSearchParams
                        var bodyPlain = `Dear Cliff Okiko,\n\n` +
                            `I have completed and digitally signed the invoice for the Letrum Travel Platform development project.\n\n` +
                            `📋 CLIENT DETAILS:\n` +
                            `Company: ${clientCompany}\n` +
                            `Email: ${clientEmail || 'Not provided'}\n` +
                            `Address: ${clientAddress || 'Not provided'}\n` +
                            `Phone: ${clientPhone || 'Not provided'}\n\n` +
                            `📄 INVOICE DETAILS:\n` +
                            `Invoice Number: KG-LTR-2025-001\n` +
                            `Total Amount: KSH 180,000\n` +
                            `Signed Date: ${new Date().toLocaleDateString()}\n\n` +
                            `💰 PAYMENT SCHEDULE AGREED:\n` +
                            `✅ 50% (KSH 90,000) - Upon contract signing - READY TO PAY\n` +
                            `⏳ 30% (KSH 54,000) - Frontend completion demo\n` +
                            `⏳ 20% (KSH 36,000) - Live deployment\n\n` +
                            `📎 SIGNED INVOICE:\n` +
                            `I have downloaded the signed PDF invoice and will attach it to this email.\n` +
                            `Original Invoice Link: ${currentURL}\n` +
                            `Reference ID: INV-${timestamp}\n\n` +
                            `🚀 NEXT STEPS:\n` +
                            `1. Invoice signed and attached\n` +
                            `2. Ready to send KSH 90,000 deposit to 0792867928\n` +
                            `3. Ready to begin 6-week development timeline\n` +
                            `4. Excited to start this project!\n\n` +
                            `📞 PAYMENT CONFIRMATION:\n` +
                            `Our preferred payment method is MPESA to this number (0792867928)\n` +
                            `Bank Details available on request.\n\n` +
                            `This invoice has been digitally signed and approved. Please proceed with the project as outlined.\n\n` +
                            `Best regards,\n${clientCompany}\n\n` +
                            `---\n` +
                            `📧 Auto-generated from signed invoice system\n` +
                            `🔗 Original form: ${currentURL}\n` +
                            `📅 Generated: ${new Date().toLocaleString()}`;

                        // Use URLSearchParams for broader compatibility
                        var params = new URLSearchParams({ subject: subject, body: bodyPlain });
                        // Use comma-separated recipients (more widely supported)
                        var mailto = 'mailto:' + recipients.join(',') + '?' + params.toString();
                        window.open(mailto);
                    showStatus('✅ Email opened! Please attach the downloaded PDF before sending.', 'success');
                }, 800);
            }).catch((err) => {
                showStatus('❌ Could not generate PDF; email not opened.', 'error');
                console.error(err);
            });
        }
        
        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case 'p':
                        e.preventDefault();
                        printInvoice();
                        break;
                    case 's':
                        e.preventDefault();
                        saveData();
                        break;
                    case 'r':
                        e.preventDefault();
                        resetForm();
                        break;
                }
            }
        });

        // Resize signature canvas for mobile
        function resizeCanvas() {
            const canvas = document.getElementById('signatureCanvas');
            if (!canvas) return;
            
            const container = canvas.parentElement;
            const containerWidth = container.clientWidth;
            
            if (containerWidth < 450) {
                canvas.width = Math.max(300, containerWidth - 40);
                canvas.height = Math.max(120, canvas.width * 0.375);
                // Need to reinitialize signature pad after resize
                if (signaturePad) {
                    signaturePad.clear();
                    hasSignature = false;
                }
            } else {
                canvas.width = 400;
                canvas.height = 150;
            }
        }

        // Initialize everything when page loads
        window.onload = function() {
            initSignaturePad();
            
            // Auto-load saved data if available
            const savedData = localStorage.getItem('letrum_invoice_data');
            if (savedData) {
                loadSavedData();
            }
        };

        // Resize on window resize and orientation change
        window.addEventListener('resize', function() {
            setTimeout(resizeCanvas, 100);
        });
        
        window.addEventListener('orientationchange', function() {
            setTimeout(resizeCanvas, 200);
        });
    </script>
</body>
</html>